{% extends "tp-layout.html" %}

{% block pageTitle %}
Manage vacancy
{% endblock %}

{% block beforeContent %}
{{super()}}
<a href="3a-live" class="govuk-back-link">Back</a>

{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <div class="govuk-notification-banner govuk-notification-banner--success" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
      <div class="govuk-notification-banner__header">
        <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
          Success
        </h2>
      </div>
      <div class="govuk-notification-banner__content">
        <h3 class="govuk-notification-banner__heading">
          Applications shared anonymously to employer's Apprenticeship service account
        </h3>
      </div>
    </div>

        <span class="govuk-caption-l">Gloucestershire Health and Care NHS Foundation Trust</span>
    <h1 class="govuk-heading-l">Entry Level Development Engineer Apprentice</h1>


  </div>
</div>

<!-- ////START SUMMARY//// -->
<dl class="govuk-summary-list">
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Status
    </dt>
    <dd class="govuk-summary-list__value">
      Live
    </dd>
  </div>
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Vacancy reference
    </dt>
    <dd class="govuk-summary-list__value">
      VAC1000000997
    </dd>
  </div>
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Closing date
    </dt>
    <dd class="govuk-summary-list__value">
      <p class="govuk-body">01 Nov 2022</p>
    </dd>
  </div>
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Possible start date
    </dt>
    <dd class="govuk-summary-list__value">
      <p class="govuk-body">01 Jan 2023</p>
    </dd>
  </div>
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Disability confident
    </dt>
    <dd class="govuk-summary-list__value">
      <p class="govuk-body">Yes</p>
    </dd>
  </div>
</dl>
<!-- ////END SUMMARY//// -->
    
<!-- vacnacy actions START -->
    <div class="grid-row">
      <div class="column-full">

        <p class="govuk-body">
          <a class="govuk-link button-link  govuk-link--no-visited-state" href="view">View vacancy</a> &nbsp;
          <a class="govuk-link button-link  govuk-link--no-visited-state" href="#">Clone vacancy</a> &nbsp;
          <a class="govuk-link button-link  govuk-link--no-visited-state" href="3c-dates">Edit vacancy dates</a> &nbsp;
          <a class="govuk-link button-link  govuk-link--no-visited-state" href="#">Close vacancy</a> 
        </p>
      </div>
    </div>

    <br>

    {{ govukButton({
      text: "View vacancy analytics",
      classes: "govuk-button--secondary",
      href: '3b-vacancy-analytics'
    }) }}
<!-- vacancy actions END -->

    <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">

<!-- Application actions -->
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <h2 class="govuk-heading-m">Manage applications</h2>

    <div class="govuk-inset-text">
      <p class="govuk-body" >
        <a href="6a-share-applications" class="govuk-link govuk-link--no-visited-state">Share multiple applications with employer</a>
      </p>
      <p class="govuk-body">
        <a href="8a-multiple-unsuccessful" class="govuk-link govuk-link--no-visited-state">Make multiple applications unsuccessful</a>
      </p>
    </div>
  
      </div>
    </div>
  <!-- end application actions -->

  
  <!-- search box START -->
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      
    <fieldset class="govuk-fieldset">
      <legend class="govuk-visually-hidden">Search employer name or account name</legend>
      <div class="govuk-form-group search-field search-field-darker">

        <div class="search-input search-input-with-button">
          <label class="govuk-label" for="query">
            <!--Client reference-->
            Search applicant name
          </label>

          <div class="autocomplete__parent_wrapper">
            <div class="autocomplete__wrapper">
              <div aria-atomic="true" aria-live="polite" role="status" style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin-bottom: -1px; margin-right: -1px; overflow: hidden; padding: 0px; position: absolute; white-space: nowrap; width: 1px;">
                <span>No search results.</span>
                <span>,,</span>
              </div>
              <input aria-owns="searchOrgs__listbox" autocomplete="off" class="autocomplete__input" id="searchOrgsAuto" name="query" placeholder="" role="combobox" type="text" style="display:none;" value="">
            </div>
          </div>
          <input class="govuk-text" name="searchOrgQuery" id="searchOrgsQuery" value="">
        </div>
        <div class="search-submit">
          <button class="govuk-button" data-module="govuk-button" type="submit" id="searchOrgsSubmit" name="searchOrgsSubmit" value="Search Organisations">Search Organisations</button>
        </div>
      </div>
    </fieldset>

  </div>
</div>
<!-- search box END -->

<!-- table START -->
{%- from "govuk/components/tag/macro.njk" import govukTag -%}

{%
  set appsTableData = [
    {
      name: "Faizal Dawood",
      id: "C5662EA",
      status: "shared",
      link: "",
      classes: "govuk-tag--yellow",
      date: "13 Oct 2022",
      disability: "Prefer not to say"
    },
    {
      name: "Keith Stewart",
      id: "678CFR0",
      status: "shared",
      link: "../account/application-employer-reviewed-yes",
      classes: "govuk-tag--yellow",
      date: "13 Oct 2022",
      disability: "Prefer not to say"
    },
    {
      name: "Cynthia Perez",
      id: "FL13JK0",
      status: "new",
      link: "",
      classes: "govuk-tag--blue",
      date: "15 Oct 2022",
      disability: "No"
    },
    {
      name: "Susie Noble",
      id: "LL13J9H",
      status: "shared",
      link: "",
      classes: "govuk-tag--yellow",
      date: "15 Oct 2022",
      disability: "No"
    },
    {
      name: "Judy Ward",
      id: "897DW5T",
      status: "shared",
      link: "../account/application-employer-reviewed-no",
      classes: "govuk-tag--yellow",
      date: "15 Oct 2022",
      disability: "No"
    },
    {
      name: "Charles Davis",
      id: "B2LH789",
      status: "shared",
      link: "",
      classes: "govuk-tag--yellow",
      date: "15 Oct 2022",
      disability: "Prefer not to say"
    },
    {
      name: "Neena Patel",
      id: "78BH067",
      status: "shared",
      link: "",
      classes: "govuk-tag--yellow",
      date: "15 Oct 2022",
      disability: "No"
    },
    {
      name: "Jose Robinson",
      id: "LY6TY44",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "15 Oct 2022",
      disability: "Prefer not to say"
    },
    {
      name: "John Smith",
      id: "39DBE1A",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "16 Oct 2022",
      disability: "Yes"
    },
    {
      name: "Danielle Price",
      id: "HAK9F56",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "16 Oct 2022",
      disability: "Yes"
    },
    {
      name: "Bryant Cantu",
      id: "5J9L5BF",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "17 Oct 2022",
      disability: "No"
    },
    {
      name: "Loretta Giles",
      id: "3LN79HH",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "17 Oct 2022",
      disability: "No"
    },
    {
      name: "Blake Peterson",
      id: "FL7J007",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "17 Oct 2022",
      disability: "No"
    },
    {
      name: "Regina Carey",
      id: "98J98FG",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "17 Oct 2022",
      disability: "No"
    },
    {
      name: "Millicent Thompson",
      id: "NJLP6GF",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "17 Oct 2022",
      disability: "No"
    },
    {
      name: "Deena Lawson",
      id: "C78N0LK",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "17 Oct 2022",
      disability: "No"
    },
    {
      name: "Garland Valenzuela",
      id: "45DL0HV",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "17 Oct 2022",
      disability: "No"
    },
    {
      name: "Jerome Cross",
      id: "79ML444",
      status: "New",
      link: "",
      classes: "govuk-tag--blue",
      date: "17 Oct 2022",
      disability: "No"
    },
    {
      name: "Ellen Collins",
      id: "6H0IL55",
      status: "Unsuccessful",
      link: "",
      classes: "govuk-tag--red",
      date: "13 Oct 2022",
      disability: "No"
    },
    {
      name: "Wes Arnold",
      id: "PL67D9F",
      status: "Unsuccessful",
      link: "",
      classes: "govuk-tag--red",
      date: "13 Oct 2022",
      disability: "No"
    }
]
%}
    <table class="govuk-table responsive-table" data-module="das-table-sort">
      <thead class="govuk-table__header">
        <tr class="govuk-table__row" role="row">

          <th scope="col" class="govuk-table__header" aria-sort="none">
            <a href="#" class="govuk-link das-table__sort das-table__sort--asc" aria-sort="ascending">Name </a>
          </th>
          <th scope="col" class="govuk-table__header das-table--double-arrows" aria-sort="none">
            <a href="#" class="govuk-link das-table__sort">Application ID</a>
          </th>
          <th scope="col" class="govuk-table__header das-table--double-arrows" aria-sort="none">
            <a href="#" class="govuk-link das-table__sort">Status</a>
          </th>
          <th scope="col" class="govuk-table__header das-table--double-arrows" aria-sort="none">
            <a href="#" class="govuk-link das-table__sort">Date applied</a>
          </th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for applicant in appsTableData %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell" role="gridcell" data-label="Name">
            <a href="{{ applicant.link }}" class="govuk-link govuk-link--no-visited-state">{{ applicant.name }}</a>
            <input type="hidden" name="{{ applicant.id }}-name" value="{{ applicant.name }}">
          </td>
          <td class="govuk-table__cell" role="gridcell" data-label="Application ID">{{ applicant.id }}</td>
          <td class="govuk-table__cell" role="gridcell" data-label="Status">
            {{ govukTag({
              text: applicant.status, 
              classes: applicant.classes
            }) }}
          </td>
          <td class="govuk-table__cell" role="gridcell" data-label="Date applied">{{ applicant.date }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
<!-- table END -->

{% endblock %}

{% block scripts %}
{{super()}}
<script>
  const selectAllCB = document.getElementById("select-all-applications");
  const allApplicantsCB = document.getElementsByName('applications');

  const tableSort = () => {
    const getCellValue = (tr, idx) => {
      return tr.children[idx].innerText || tr.children[idx].textContent
    };

    const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
                    v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2)
    )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));

    const sortableTable = document.querySelector('[data-module="das-table-sort"]');
    const allSortLinks = sortableTable.querySelectorAll('.govuk-table__header .govuk-link');

    const handleClick = event => {
      event.preventDefault();
      const sortLink = event.target

      allSortLinks.forEach(link => {
        if (link === event.target) return false;
        link.parentNode.classList.add("das-table--double-arrows")
        link.classList.remove("das-table__sort--asc", "das-table__sort--desc")
        link.setAttribute("aria-sort", "none")
      });

      if (sortLink.classList.contains("das-table__sort--asc")) {
        sortLink.parentNode.classList.remove("das-table--double-arrows")
        sortLink.classList.replace("das-table__sort--asc", "das-table__sort--desc")
        sortLink.setAttribute("aria-sort", "descending")
      } else if (sortLink.classList.contains("das-table__sort--desc")) {
        sortLink.parentNode.classList.remove("das-table--double-arrows")
        sortLink.classList.replace("das-table__sort--desc", "das-table__sort--asc")
        sortLink.setAttribute("aria-sort", "ascending")
      } else {
        sortLink.parentNode.classList.remove("das-table--double-arrows")
        sortLink.classList.add("das-table__sort--desc")
        sortLink.setAttribute("aria-sort", "descending")
      }

      Array.from(sortableTable.querySelectorAll('.govuk-table__body .govuk-table__row'))
              .sort(comparer(Array.from(sortLink.parentNode.parentNode.children)
                      .indexOf(sortLink.parentNode), this.asc = !this.asc))
              .forEach(tr => sortableTable.querySelector(".govuk-table__body").appendChild(tr));
    }

    allSortLinks.forEach(link => {
      link.addEventListener('click', handleClick)
    });
  }

  if (document.querySelector('[data-module="das-table-sort"]')) {
    tableSort();
  }
</script>

{% endblock %}
